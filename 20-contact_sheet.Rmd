---
title: Contact Sheets 
date: 22.11.2020
output:
  html_document:
    keep_html: TRUE
    df_print: paged
  pdf_document: default
---

```{r, include = FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "data-contact-sheets/fat80_768x384-",
  out.width = "100%"
)

`%>%` <- purrr::`%>%`

options(buildtools.check = NULL)
# devtools::install_github('r-lib/ragg')
# install.packages("zeallot")
# install.packages("patchwork")
```

```{r}
inch <- function(w, h, ppi) sqrt((w/ppi)^2 + (h/ppi)^2)
inch(5120, 2880, ppi = 218) # iMac
inch(2560, 1600, ppi = 227) # MacBook Pro
```

[Using a Retina display](https://support.apple.com/en-us/HT202471),
[dpilove](https://dpi.lv/#27â€³):

1. 27-inch iMac models introduced in 2014 or later. 
   Native resolution: 5120 x 2880 (16:9) at 218 ppi (pixels per inch).
   Models introduced in 2014 and 2015 support millions of colors,
   and models introduced in 2017 or later support one billion colors.
   Approx. 23 x 13 in.
1. 13-inch MacBook Pro models introduced in late 2012 or later. 
   Native resolution: 2560 x 1600 (16:10) at 227 ppi.
   Support for millions of colors.
   Approx 11 x 7 in.
   

[Taking Control of Plot Scaling](https://www.tidyverse.org/blog/2020/08/taking-control-of-plot-scaling/).

```{r}
library(tidyverse, warn.conflicts = FALSE)
library(patchwork)
library(ragg)
library(zeallot)

library(rraysplot)
packageVersion("rraysplot", lib.loc = "~/Library/R/4.0/library/")
```

*iMac*, *MacBook Pro* width and height in cm

```{r}
c(width_in, height_in) %<-% (c(3240, 1080) / 218)
c(width_in, height_in) * 2.54
c(width_in, height_in) %<-% (c(2160, 720) / 227)
c(width_in, height_in) * 2.54
```

```{r}
# agg_jpeg(width = 3240, height = 1080, res = 218, 
#   scaling = 1, quality = 100)
# agg_jpeg(
#   width = 2160, height = 720, res = 227,
#   scaling = 1, quality = 100
# )
```

```{r}
# str(fat80_768x384)
c(
  c(image_train, ., scat_train, vsat_train),
  c(image_test, ., scat_test, vsat_test)
) %<-% fat80_768x384
```

```{r}
dim(image_test)
```

```{r}
dimnames(image_test)[[1]]
```

## Patchworks

```{r}
i = 10
img = image_test[i,,]
scat = scat_test[i,,]
vsat <- vsat_test[i,,]
```

```{r contact-sheet, fig.show="hold", fig.asp = 0.5, out.width="33.33%"}
plot_array2d(img)
plot2_array2d(img, scat)
plot2_array2d(img, vsat)
```

```{r contact-sheet, fig.show="hold", fig.asp = 0.5, out.width="33.33%"}

```






## TODO

```{r}
plot_tensors <- function(arraylist, plottitles) {
  n_col = length(plottitles)

  plot_title <- function(title) cowplot::ggdraw() + cowplot::draw_text(title)

  plots_titles = purrr::map(plottitles, plot_title)
  plots <- purrr::map(arraylist, plot_array2d)

  row1 <- cowplot::plot_grid(
    plotlist = plots_titles,
    ncol = n_col
  ) +
    ggplot2::theme(plot.margin = ggplot2::margin(8, 0, 0, 0))

  row2 <- cowplot::plot_grid(
    plotlist = plots,
    ncol = n_col,
    align = "hv"
  )

  cowplot::plot_grid(
    row1, row2,
    align = "hv", ncol = 1,
    # rel_heights values control vertical title margins
    rel_heights = c(0.11, 1)
  ) +
    cowplot::theme_nothing(
      font_size = 18
    )
}
```

```{r}
(jpegfile <- fs::path("./", "downscaling2.jpeg"))

agg_jpeg(jpegfile, width = 3240, height = 1080, units = "px", res = 227, scaling = 2)
plot(p)
invisible(dev.off())
```




